FROM rabbitmq:3.12-management

# Copy pre-downloaded plugin into the RabbitMQ plugins directory
COPY rabbitmq_delayed_message_exchange-3.12.0.ez /usr/lib/rabbitmq/plugins/

# Fix ownership
RUN chown rabbitmq:rabbitmq /usr/lib/rabbitmq/plugins/rabbitmq_delayed_message_exchange-3.12.0.ez

# Switch to rabbitmq user
USER rabbitmq

# Enable plugin offline
RUN rabbitmq-plugins enable --offline rabbitmq_delayed_message_exchange

WORKDIR /var/lib/rabbitmq
