FROM rabbitmq:3.12-management

# Copy plugin into RabbitMQ plugin directory
COPY plugins/rabbitmq_delayed_message_exchange-3.12.0.ez /opt/rabbitmq/plugins/

# Fix permissions
USER root
RUN chown rabbitmq:rabbitmq /opt/rabbitmq/plugins/rabbitmq_delayed_message_exchange-3.12.0.ez
USER rabbitmq

# RabbitMQ will start normally; enable plugin at container start